# 🛠️ Dev Log - Recall 專案
**Date:** 2025-08-16

---

## ✅ 今日進度總結

### 🎯 主要任務：
完成 Recall Panel UI 與 HLA 系統整合

### 📋 完成項目：

#### 1. **Recall Panel 狀態機實現**
- ✅ 建立三狀態架構：`EnemyPhase` / `PlayerPhase` / `Selecting`
- ✅ 狀態轉換邏輯與按鈕控制
- ✅ 輔助函數 `SetButtonStates()` 統一管理按鈕狀態

#### 2. **槽位選取系統**
- ✅ 槽位點擊事件綁定（閉包捕獲索引）
- ✅ 變色選取方案（藍色高亮）替代 ToggleMode
- ✅ 空槽位和本回合槽位禁用邏輯
- ✅ 動態 Confirm 按鈕啟用

#### 3. **HLA 整合與信號系統**
- ✅ `ConfirmPressed` Signal 攜帶選取索引
- ✅ Combat.cs 事件連接與 RecallIntent 建構
- ✅ `TryRunRecall()` 完整流程實現
- ✅ Phase 系統整合（PlayerDraw 階段開放）

#### 4. **UI 顯示系統**
- ✅ Memory Timeline 快照顯示
- ✅ 自動刷新機制（三個時機點）
- ✅ EnemyView 基礎實現

#### 5. **測試與 Debug**
- ✅ 手動單元測試驗證三狀態切換
- ✅ 槽位選取邏輯測試
- ✅ HLA 翻譯與命令執行驗證

---

## 🐞 解決的技術問題

| 問題描述 | 解決方案 | 學習重點 |
|----------|----------|----------|
| ToggleMode 不生效 | 改用 `Modulate` 變色方案 | UI 框架內建功能不如手動實現可靠 |
| 狀態管理複雜 | 採用狀態機設計，消除 bool flag | 狀態機比多重標記更清晰 |
| 重複觸發問題 | Phase 變化檢測，避免重複設定 | UI 控制需要防呆機制 |
| Debug 輸出誤導 | Actor 類型名稱無法區分實例 | Debug 訊息需要更精確的標識 |

---

## 🧩 核心架構確立

### **UI 狀態機流程：**
```
EnemyPhase (全禁用) ⟷ PlayerPhase (Recall可用) ⟷ Selecting (槽位可選)
```

### **HLA 執行鏈：**
```
UI Click → Signal → RecallIntent → HLATranslator → InterOps → AtomicCmd → Execute
```

### **數值設計確認：**
- A (Attack): 5 傷害，消耗 1 Charge
- B (Block): 6 護盾，消耗 1 Charge  
- C (Charge): 獲得 2 Charge，消耗 1 AP

---

## 🔜 後續開發重點

### **短期任務：**
- [ ] EnemyView HP 顯示問題修正
- [ ] Memory 寫入時機優化
- [ ] Phase 系統的 Recall 禁用邏輯

### **中期目標：**
- [ ] Enemy AI 基礎實現
- [ ] 勝負判定系統
- [ ] 完整戰鬥流程測試

### **長期架構：**
- [ ] 卡牌系統整合準備
- [ ] Echo 系統基礎設計

---

## 📝 重要設計決策

### **UI Controller 複雜度接受：**
UI 承擔狀態翻譯與防呆責任，比 Core 邏輯複雜是正常現象。關鍵是保持 Core 純淨，UI 處理複雜交互。

### **實用主義優於理論完美：**
- 變色方案比 ToggleMode 更可靠
- 手動狀態管理比依賴框架更可控

---

## 🎯 今日成果評估

**UI 系統**: ✅ 完成 - 三狀態切換、槽位選取、信號整合全部正常運作  
**HLA 整合**: ✅ 完成 - 從 UI 到命令執行的完整鏈路打通  
**測試驗證**: ✅ 完成 - 手動測試確認核心功能無誤  

**整體進度**: Recall 系統核心功能已完備，可進入下階段開發！

---

## 🔗 相關 Git 提交

- `e197963` - Fix gain charge
- `443f90f` - Deal damage UI  
- `ff6ba4f` - Recall panel control
- `ac38c29` - Setup basic moves
- `950090f` - Setup intent to cmd pipeline

**主要提交**: Fix gain charge - 完成 Recall Panel 狀態機與 HLA 整合