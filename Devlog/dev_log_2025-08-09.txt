âœ… 2025-08-08ã€ŠRecallã€‹Combat UI Signal Relay ç³»çµ±é–‹ç™¼ç´€éŒ„
ğŸ¯ æ ¸å¿ƒç›®æ¨™
å»ºç«‹å¾è³‡æ–™å±¤ (Charge) åˆ° UI (PlayerView) çš„è¨Šè™Ÿæ›´æ–°æ©Ÿåˆ¶ï¼Œä¸ç¶“é Godot signalï¼Œä¸¦ä¿æŒè³‡æ–™é‚è¼¯èˆ‡ UI å®Œå…¨è§£è€¦ã€‚

âœ… å®Œæˆé …ç›®
ğŸ”§ 1. Charge Component å¯¦ä½œé€šçŸ¥é‚è¼¯
æ”¹ç‚ºç´”è³‡æ–™çµæ§‹ Charge.csï¼Œä¸ç¹¼æ‰¿ Node

æ¯æ¬¡è®ŠåŒ–æ™‚å‘¼å« UISignalHub.NotifyChargeChanged(Value);

å®Œå…¨ä¸ä¾è³´ EmitSignalã€Nodeã€Callbackï¼Œå–®å‘è³‡æ–™å›å ±

ğŸ”§ 2. å»ºç«‹ UISignalHub ä¸­ä»‹å±¤
ä½¿ç”¨ static class + Action<int>? çµæ§‹è¨­è¨ˆ

æ–¹æ³•ï¼šNotifyChargeChanged(int) â†’ å‘¼å«è¨»å†Šè€…

UI å±¤å¯ç›´æ¥ += æˆ– -= è¨‚é–±è®ŠåŒ–ï¼Œä¸éœ€ Godot signal

ğŸ”§ 3. PlayerView æˆåŠŸæ¥æ”¶è¨Šè™Ÿä¸¦æ›´æ–° UI
åŠ å…¥ UISignalHub.OnChargeChanged += (...) è¨‚é–±é‚è¼¯

ä½¿ç”¨ ChargeLabel.Text = $"Charge: {value}/3" å¯¦æ™‚æ›´æ–°ç•«é¢

åŠ ä¸Š BindActor(Actor) + UpdateVisual() æ¨¡çµ„åŒ–é‚è¼¯

ğŸ§¼ 4. ç§»é™¤ Combat ç™¼é€ Godot Signal çš„éæ™‚å¯«æ³•
åŸæœ¬å˜—è©¦ç”¨ EmitSignal(nameof(ChargeChangedEventHandler)) ç™¼é€ UI æ›´æ–°

æœ€çµ‚å› æœªè¢« PlayerView è¨‚é–± + runtime register éŒ¯èª¤ï¼ˆGD0201, ERR_UNAVAILABLEï¼‰â†’ ç§»é™¤

æ”¹ç‚ºå–®ç´”è½‰ç™¼ UI äº‹ä»¶çš„ UISignalHub è¨­è¨ˆ

ğŸ› ï¸ 5. Debug æ”¯æ´èˆ‡éŒ¯èª¤è™•ç†
å¤šæ¬¡æ’æŸ¥ Godot signal ç„¡æ³•è¨»å†Šå•é¡Œï¼Œæœ€çµ‚ç¢ºå®šæ˜¯ Combat ç¯€é»æœªåˆ·æ–° C# signal metadata å°è‡´

æˆåŠŸåˆ‡æ›æ¶æ§‹è‡³ UI hub è¨‚é–±å¼æ¨¡å¼å¾Œï¼Œä¸€åˆ‡è¡Œç‚ºç©©å®š

â— é‡åˆ°çš„éŒ¯èª¤èˆ‡è™•ç†æ–¹å¼
éŒ¯èª¤é¡å‹	è§£æ³•
CS0103 signal åç¨±ä¸å­˜åœ¨	åŸå› ï¼šæœªåŠ  [Signal] æˆ–å‘½åä¸ç¬¦åˆ Godot è¦ç¯„
GD0201 signal åç¨±éœ€ä»¥ EventHandler çµå°¾	âœ… æ”¹åç‚º ChargeChangedEventHandler
ERR_UNAVAILABLE emit signal ä¸å­˜åœ¨	âœ… æœ€çµ‚æ¨æ£„ EmitSignal åšæ³•ï¼Œæ”¹ç‚º UI Hub callback
Control GetNode() éŒ¯èª¤	âœ… ä½¿ç”¨ [Export] æˆ–ç›¸å°è·¯å¾‘å–å¾—ç¯€é»

ğŸ“ å½±éŸ¿èˆ‡æ›´æ–°çš„æª”æ¡ˆ
Component.csï¼ˆChargeï¼‰

UISignalHub.cs

PlayerView.cs

Combat.csï¼ˆå¾Œä¾†ç°¡åŒ–ï¼Œç§»é™¤ signalï¼‰

ğŸ“ˆ ä»Šæ—¥æˆæœç¸½çµ
æ¨¡çµ„	ç‹€æ…‹
Charge â†’ Notify	âœ… æˆåŠŸ
UISignalHub ä¸­ç¹¼	âœ… æˆåŠŸ
PlayerView è¨‚é–±æ›´æ–°	âœ… æˆåŠŸ
Godot Signal æ¸¬è©¦	âœ… å˜—è©¦é â†’ æœ€çµ‚ç§»é™¤
UI é€£å‹•æ¸¬è©¦	âœ… é¡¯ç¤º Charge: X/3 æ­£å¸¸æ›´æ–°

ğŸ”œ å»ºè­°ä¸‹å€‹æ­¥é©Ÿ
æ”¯æ´æ›´å¤šå±¬æ€§ï¼ˆå¦‚ HPã€Shieldï¼‰â†’ åŠ å…¥ OnHPChanged ç­‰æ¬„ä½

åŠ å…¥ actorId â†’ æ”¯æ´å¤šè§’è‰²è¨Šè™Ÿï¼ˆe.g., NotifyChargeChanged(string actorId, int value))

è½‰ç‚º ActorView æ³›å‹çµæ§‹ â†’ å¯æ”¯æ´ Player / Enemy

åŠ å…¥ Disconnect æ¸…ç† (-=) æˆ– _ExitTree() æ¸…é™¤è¨‚é–±